<!DOCTYPE html>
<html>
<head>
  <title>MusicFest ID Card</title>
  <meta charset="utf-8" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Special+Gothic+Expanded+One&family=Prompt:wght@400;600;700&family=Doto&display=swap" rel="stylesheet">
  <style>
    :root {
      --blue-dark: #2657ab;
      --blue-light: #5773a1;
      --green-dark: #377253;
      --green-light: #457b61;
      --red-accent: #bb4237;
      --bg-cream: #dee0d1;
    }

    body {
      font-family: 'Prompt', sans-serif;
      padding: 20px;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }

    #idCard {
      width: 600px;
      height: 380px;
      background-color: var(--bg-cream);
      border-radius: 40px;
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .star {
      position: absolute;
      font-size: 220px;
      line-height: 1;
      filter: drop-shadow(6px 6px 0 rgba(255,255,255,0.35));
      z-index: 2;
    }
    .star-red   { top: -40px; right: -20px; color: var(--red-accent); transform: rotate(15deg); z-index: 3; }
    .star-blue  { bottom: -60px; left: 10px; font-size: 190px; color: var(--blue-light); transform: rotate(-10deg); }
    .star-green { top: -50px; left: -40px; font-size: 200px; color: var(--green-light); transform: rotate(-8deg); }

    .header-bar {
      background-color: var(--green-dark);
      height: 85px;
      width: 100%;
      display: flex;
      align-items: center;
      padding: 0 30px;
      position: relative;
      z-index: 3;
    }

    .header-text {
      font-family: 'Special Gothic Expanded One', sans-serif;
      font-size: 46px;
      font-weight: 900;
      letter-spacing: -1px;
      color: #ffffff;
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    .editable-inline {
      outline: none;
      cursor: text;
    }

    #sigSpace {
      border-bottom: 3px dotted #ffffff;
      min-width: 120px;
      text-transform: uppercase;
      font-size: 28px;
      letter-spacing: 2px;
    }

    /* date: top-right */
    #headerDate {
      position: absolute;
      right: 75px;
      top: 50%;
      transform: translateY(-50%);
      max-width: 180px;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: 'Doto', monospace;
      font-size: 22px;
      letter-spacing: 2px;
      color: #eaeaea;
      white-space: nowrap;
      z-index: 10;
    }

    .card-body {
      display: flex;
      padding: 20px 35px;
      gap: 30px;
      z-index: 3;
    }

    .photo-area {
      width: 170px;
      height: 170px;
      background-color: #fff;
      border: 6px solid #000;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      flex-shrink: 0;
      margin-top: 10px;
      position: relative;
    }

    #photoPreview {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      min-width: 100%;
      min-height: 100%;
      object-fit: unset;
      cursor: grab;
      user-select: none;
      touch-action: none;
      display: none;
    }

    #photoPlaceholder {
      font-size: 14px;
      color: #666;
      text-align: center;
      padding: 10px;
    }

    /* centered upload button inside photo box */
    .photo-upload-label {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 8px 14px;
      background-color: var(--green-dark);
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-family: 'Prompt', sans-serif;
      text-align: center;
      z-index: 5;
    }

    .info-area {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 10px;
    }

    .field-row {
      border-bottom: 2px dotted #333;
      padding-bottom: 6px;
      display: flex;
      align-items: baseline;
    }

    .field-label {
      font-weight: 600;
      margin-right: 8px;
      white-space: nowrap;
      font-size: 13px;
      letter-spacing: 0.5px;
    }

    .field-value {
      color: #000;
      font-family: monospace;
      font-size: 18px;
      font-weight: bold;
    }

    .dob { letter-spacing: 2px; }

    .footer-bar {
      background-color: var(--blue-dark);
      height: 50px;
      width: 100%;
      position: absolute;
      bottom: 0;
      z-index: 2;
    }

    /* “ยัง ... อยู่ ...” */
    .footer-text-wrapper {
      position: absolute;
      bottom: 4px;
      right: 0px;
      z-index: 3;
      display: flex;
      align-items: baseline;
      gap: 1px;
      font-family: 'Special Gothic Expanded One', sans-serif;
      font-size: 32px;
      font-weight: 800;
      letter-spacing: 1px;
      color: var(--bg-cream);
      white-space: nowrap;
    }

    .label-yang {
      margin-right: 4px;
    }

    .label-yuu {
      margin-left: 4px;
      margin-right: 4px;
    }

    #footerMiddle,
    #footerAfter {
      width: 120px;
      border-bottom: 3px dotted var(--bg-cream);
      text-transform: uppercase;
      outline: none;
      cursor: text;
      display: inline-block;
      overflow: hidden;
      text-overflow: clip;
      white-space: nowrap;
    }

    #footerMiddle { min-width: 5px; }
    #footerAfter  { min-width: 1px; }

    /* bottom-left message */
    .footer-message {
      position: absolute;
      bottom: 12px;
      left: 26px;
      z-index: 3;
      font-size: 11px;
      max-width: 230px;
      color: #d6d9ff;
      font-family: 'Prompt', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      line-height: 1.2;
    }

    .footer-line-top {
      text-align: center;
    }

    .footer-young {
      text-align: center;
    }

    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .btn {
      padding: 8px 14px;
      background-color: var(--blue-dark);
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      font-family: 'Prompt', sans-serif;
    }

    .file-label {
      display: inline-block;
      padding: 8px 14px;
      background-color: var(--green-dark);
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    #imgInput {
      display: none;
    }

    .hint {
      font-size: 12px;
      color: #555;
      text-align: center;
      max-width: 480px;
    }
  </style>
</head>
<body>

  <div class="controls">
    <label for="imgInput" class="file-label">Upload photo</label>
    <button class="btn" id="btnDownload">Download Card</button>
    <div class="hint">
      After uploading: drag to move, scroll to zoom in/out (or pinch on mobile).
    </div>
  </div>

  <div id="idCard">
    <div class="star star-green">★</div>
    <div class="star star-red">★</div>
    <div class="star star-blue">★</div>

    <div class="header-bar">
      <div class="header-text">
        I
        <span id="sigSpace"
              class="editable-inline"
              contenteditable="true">......</span>
        Card
      </div>
      <div id="headerDate">13 FEB 2026</div>
    </div>

    <div class="card-body">
      <div class="photo-area">
        <img id="photoPreview" src="">
        <span id="photoPlaceholder"></span>

        <label for="imgInput" class="photo-upload-label" id="photoUploadLabel">Upload photo</label>
        <input type="file" id="imgInput" accept="image/*">
      </div>

      <div class="info-area">
        <div class="field-row">
          <span class="field-label">มายเนมอีส:</span>
          <span class="field-value editable-inline"
                id="dispName"
                contenteditable="true"></span>
        </div>

        <div class="field-row">
          <span class="field-label">วันที่คลอด:</span>
          <span class="field-value dob editable-inline"
                id="dispDob"
                contenteditable="true"></span>
        </div>

        <div class="field-row">
          <span class="field-label">3 คำเด็ด:</span>
          <span class="field-value">
            <span class="editable-inline"
                  id="dispW1"
                  contenteditable="true"></span>
            /
            <span class="editable-inline"
                  id="dispW2"
                  contenteditable="true"></span>
            /
            <span class="editable-inline"
                  id="dispW3"
                  contenteditable="true"></span>
          </span>
        </div>

        <div class="field-row">
          <span class="field-label">วงที่ชอบ:</span>
          <span class="field-value editable-inline"
                id="dispBand"
                contenteditable="true"></span>
        </div>

        <div class="field-row">
          <span class="field-label">เพลงโปรด:</span>
          <span class="field-value editable-inline"
                id="dispSong"
                contenteditable="true"></span>
        </div>
      </div>
    </div>

    <!-- footer text: ยัง ____ อยู่ ____ -->
    <div class="footer-text-wrapper">
      <span class="label-yang">ยัง</span>
      <span id="footerMiddle"
            class="editable-inline"
            contenteditable="true">......</span>
      <span class="label-yuu">อยู่</span>
      <span id="footerAfter"
            class="editable-inline"
            contenteditable="true">......</span>
    </div>

    <div class="footer-message">
      <div class="footer-line-top">
        Who once holds this card always a
      </div>
      <div class="footer-young">
        “YOUNG”
      </div>
    </div>

    <div class="footer-bar"></div>
  </div>

  <script>
    const id = document.getElementById.bind(document);

    const sigSpace         = id('sigSpace');
    const dispName         = id('dispName');
    const dispDob          = id('dispDob');
    const imgInput         = id('imgInput');
    const btnDownload      = id('btnDownload');
    const photo            = id('photoPreview');
    const photoArea        = document.querySelector('.photo-area');
    const photoPlaceholder = id('photoPlaceholder');
    const footerMiddle     = id('footerMiddle');
    const footerAfter      = id('footerAfter');
    const photoUploadLabel = id('photoUploadLabel');

    // header signature placeholder
    sigSpace.addEventListener('blur', () => {
      if (sigSpace.innerText.trim() === '') sigSpace.innerText = '......';
    });

    // footer placeholders
    footerMiddle.addEventListener('blur', () => {
      if (footerMiddle.innerText.trim() === '') footerMiddle.innerText = '......';
    });

    footerAfter.addEventListener('blur', () => {
      if (footerAfter.innerText.trim() === '') footerAfter.innerText = '......';
    });

    // DOB auto formatting
    dispDob.addEventListener('input', () => {
      let val = dispDob.innerText.replace(/\D/g, '');
      if (val.length > 8) val = val.substring(0, 8);
      let out = val;
      if (val.length > 4) out = val.slice(0, 2) + '/' + val.slice(2, 4) + '/' + val.slice(4);
      else if (val.length > 2) out = val.slice(0, 2) + '/' + val.slice(2);
      dispDob.innerText = out;

      const range = document.createRange();
      const sel = window.getSelection();
      range.selectNodeContents(dispDob);
      range.collapse(false);
      sel.removeAllRanges();
      sel.addRange(range);
    });

    // photo drag / zoom
    let scale = 1;
    let posX = 0;
    let posY = 0;
    let isDragging = false;
    let startX = 0;
    let startY = 0;
    let lastTouchDist = null;

    function updatePhotoTransform() {
      photo.style.transform =
        `translate(calc(-50% + ${posX}px), calc(-50% + ${posY}px)) scale(${scale})`;
    }

    photo.addEventListener('mousedown', e => {
      isDragging = true;
      startX = e.clientX - posX;
      startY = e.clientY - posY;
      photo.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', e => {
      if (!isDragging) return;
      posX = e.clientX - startX;
      posY = e.clientY - startY;
      updatePhotoTransform();
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
      photo.style.cursor = 'grab';
    });

    photoArea.addEventListener('wheel', e => {
      e.preventDefault();
      const delta = e.deltaY > 0 ? -0.1 : 0.1;
      scale = Math.min(3, Math.max(0.5, scale + delta));
      updatePhotoTransform();
    });

    function getTouchDistance(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.hypot(dx, dy);
    }

    photoArea.addEventListener('touchstart', e => {
      if (e.touches.length === 1) {
        isDragging = true;
        startX = e.touches[0].clientX - posX;
        startY = e.touches[0].clientY - posY;
      } else if (e.touches.length === 2) {
        lastTouchDist = getTouchDistance(e.touches);
      }
    });

    photoArea.addEventListener('touchmove', e => {
      e.preventDefault();
      if (e.touches.length === 1 && isDragging) {
        posX = e.touches[0].clientX - startX;
        posY = e.touches[0].clientY - startY;
        updatePhotoTransform();
      } else if (e.touches.length === 2) {
        const newDist = getTouchDistance(e.touches);
        const delta = (newDist - lastTouchDist) * 0.005;
        scale = Math.min(3, Math.max(0.5, scale + delta));
        updatePhotoTransform();
        lastTouchDist = newDist;
      }
    });

    photoArea.addEventListener('touchend', () => {
      isDragging = false;
      lastTouchDist = null;
    });

    // image upload
    imgInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = ev => {
        photo.src = ev.target.result;
        photo.style.display = 'block';
        photoPlaceholder.style.display = 'none';
        if (photoUploadLabel) {
          photoUploadLabel.style.display = 'none';
        }

        scale = 1;
        posX = 0;
        posY = 0;
        updatePhotoTransform();
      };
      reader.readAsDataURL(file);

      e.target.value = '';
    });

    btnDownload.addEventListener('click', () => {
      if (!dispName.innerText.trim()) {
        alert('Please enter your name on the card first.');
        return;
      }
      html2canvas(id('idCard'), {
        scale: 2,
        useCORS: true,
        backgroundColor: null
      }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'MusicFest-ID.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    });
  </script>
</body>
</html>
